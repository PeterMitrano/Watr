<html>
  <head>
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="{{  url_for('static', filename='style.css') }}" type="text/css"/>
    <title>Rank</title>
  </head>
  <body>
    <h1>Reports</h1>
    <div id="map"></div>
	<script>
    var map;
    var geocoder;
    var markers = [];
	function initMap() {
        var reports = {{ reports|tojson|safe }};
		//var myLatLng = {lat: -25.363, lng: 131.044};

        geocoder = new google.maps.Geocoder();
		map = new google.maps.Map(document.getElementById('map'), {
			zoom: 4,
            center: {lat: 37.09024, lng: -95.712891}
		});

        for( var report of reports ) {
            if(!('zip_code' in report)) {
                alert("Improperly formed report!");
                continue;
            }
            geocoder.geocode({'address': report.zip_code, 'region':'us'}, function(results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    markers.push(new google.maps.Marker({
                        position: results[0].geometry.location,
                        zip_code: report.zip_code,
                        map: map,

                    }));
                    
                    
                } else {
                    alert("Geocode failed: " + status);
                }
            });
        }

        /*
        var markers = reports.map(function(report) {
            return new google.maps.Marker({
                position: report.latlong,
                map: map,
                title: '
            });
        });

		var marker = new google.maps.Marker({
			position: myLatLng,
			map: map,
			title: 'Hello World!'
		});
        */
	}
	</script>
    <div id="main">
    </div>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key={{api_key}}&signed_in=true&callback=initMap">
    </script>
  </body>
</html>
